# v1.1.0 测试说明

> 本文档说明如何测试 MD Viewer v1.1.0 的新功能

---

## 🎯 v1.1.0 新功能

1. **Mermaid 图表支持** - 在 Markdown 中渲染流程图、时序图等
2. **实时文件监听** - 文件修改时自动刷新，无需手动重载

---

## 📊 测试 Mermaid 图表渲染

### 步骤 1：使用测试文件

项目已提供测试文件，位于 `e2e/fixtures/` 目录：

- `test-mermaid.md` - Mermaid 图表测试（流程图、时序图、类图、状态图、甘特图）
- `test-katex.md` - KaTeX 数学公式测试（行内公式、块级公式）
- `test-watch.md` - 文件监听测试

### 步骤 2：测试渲染

1. **启动应用**
   ```bash
   npm run dev
   ```

2. **打开文件夹** - 选择项目的 `e2e/fixtures` 文件夹

3. **点击文件** - 在文件树中点击 `test-mermaid.md` 或 `test-katex.md`

4. **验证渲染**
   - ✅ 流程图应该正确显示（带箭头和判断框）
   - ✅ 时序图应该显示 Alice 和 Bob 的对话
   - ✅ 类图应该显示类的继承关系
   - ✅ 状态图应该显示状态转换
   - ✅ 甘特图应该显示项目时间线

5. **测试主题切换**
   - 切换系统到暗色模式
   - Mermaid 图表应该自动切换为暗色主题
   - 图表仍然清晰可读

### 预期结果

- 所有图表正确渲染为 SVG
- 图表居中显示，有边框和内边距
- 暗色模式下图表颜色适配
- 图表可缩放（浏览器缩放）

### 常见问题

**Q: 图表不显示，只显示代码？**
A: 检查控制台是否有错误，可能是 Mermaid 语法错误

**Q: 图表渲染错误？**
A: Mermaid 语法有误，检查官方文档：https://mermaid.js.org/

---

## 👀 测试文件监听与自动刷新

### 步骤 1：准备测试环境

1. 使用项目提供的测试文件 `e2e/fixtures/test-watch.md`

2. 启动应用并打开 `e2e/fixtures` 文件夹

### 步骤 2：测试文件修改自动刷新

1. **打开文件** - 在 MD Viewer 中打开 `test-watch.md`

2. **用外部编辑器修改** - 使用 VS Code、Vim 或其他编辑器修改文件：
   ```markdown
   # 文件监听测试

   当前时间：2026-01-03 00:05

   这是第 2 次修改。✨
   ```

3. **保存文件**（Cmd+S 或 Ctrl+S）

4. **观察 MD Viewer** - 应该自动刷新显示新内容
   - ✅ 内容立即更新（1-2秒内）
   - ✅ 不需要手动刷新
   - ✅ 标签页不闪烁
   - ✅ 滚动位置保持（可能需要手动滚动）

5. **检查控制台** - 应该看到日志：
   ```
   File changed: /path/to/test-watch.md
   ```

### 步骤 3：测试文件添加自动刷新

1. **在同一文件夹中创建新文件** `new-file.md`
   ```bash
   echo "# 新文件" > new-file.md
   ```

2. **观察 MD Viewer 的文件树** - 应该自动刷新
   - ✅ 文件树显示新文件
   - ✅ 1-2秒内出现
   - ✅ 文件按字母顺序排列

3. **检查控制台** - 应该看到日志：
   ```
   File added, refreshing file list
   ```

### 步骤 4：测试文件删除自动刷新

1. **删除之前创建的文件**
   ```bash
   rm new-file.md
   ```

2. **观察 MD Viewer**
   - ✅ 文件树中文件消失
   - ✅ 如果该文件已打开，对应标签自动关闭
   - ✅ 1-2秒内生效

3. **检查控制台** - 应该看到日志：
   ```
   File removed: /path/to/new-file.md
   ```

### 预期结果

| 操作 | 预期行为 | 响应时间 |
|------|---------|---------|
| 修改文件 | 已打开的标签自动刷新 | 1-2秒 |
| 添加文件 | 文件树自动刷新 | 1-2秒 |
| 删除文件 | 标签关闭 + 文件树刷新 | 1-2秒 |

### 高级测试

#### 多文件同时修改
1. 打开 3 个 Markdown 文件
2. 用 VS Code 同时修改这 3 个文件
3. 保存所有文件
4. 所有打开的标签应该都自动刷新

#### 大量文件操作
1. 批量创建 10 个 Markdown 文件
2. 文件树应该逐步刷新（可能分批显示）
3. 应用不应崩溃或卡顿

#### 文件夹嵌套
1. 在子文件夹中创建/修改/删除文件
2. 监听应该递归工作
3. 所有操作都应该被检测到

### 常见问题

**Q: 文件修改后没有自动刷新？**
A:
1. 检查控制台是否有错误
2. 确认文件监听已启动（打开文件夹时自动启动）
3. 某些编辑器使用原子写入，可能需要稍等片刻

**Q: 文件树刷新太频繁？**
A: 正常现象，chokidar 会立即检测到变化

**Q: 应用性能下降？**
A: 如果监听超过 1000 个文件，可能会有性能影响

---

## ✅ 完整测试清单

### Mermaid 功能
- [ ] 流程图正确渲染
- [ ] 时序图正确渲染
- [ ] 类图正确渲染
- [ ] 状态图正确渲染
- [ ] 甘特图正确渲染
- [ ] 暗色主题适配正确
- [ ] 图表语法错误时保留原始代码
- [ ] 图表可缩放

### 文件监听功能
- [ ] 文件修改自动刷新标签页
- [ ] 文件添加自动刷新文件树
- [ ] 文件删除自动关闭标签
- [ ] 多文件同时修改正确处理
- [ ] 子文件夹中的文件也能监听
- [ ] 控制台日志正确输出
- [ ] 应用性能无明显下降
- [ ] 没有内存泄漏

### 回归测试（确保旧功能没有破坏）
- [ ] 文件树浏览正常
- [ ] 多标签切换正常
- [ ] 代码高亮正常
- [ ] 数学公式正常
- [ ] 搜索功能正常
- [ ] 导出 HTML 正常
- [ ] 导出 PDF 正常
- [ ] 状态持久化正常

---

## 🐛 发现 Bug？

如果发现任何问题，请记录：

1. **问题描述** - 详细说明问题
2. **复现步骤** - 如何触发问题
3. **预期行为** - 应该发生什么
4. **实际行为** - 实际发生了什么
5. **环境信息**
   - 操作系统版本
   - MD Viewer 版本
   - 测试文件大小
   - 控制台错误日志

---

## 📊 性能测试（可选）

### 大文件测试
1. 创建一个包含 100 个 Mermaid 图表的文件
2. 打开该文件
3. 观察渲染时间和应用响应性

### 大文件夹测试
1. 打开包含 500+ Markdown 文件的文件夹
2. 观察文件树加载时间
3. 修改文件，观察刷新时间

### 长时间运行测试
1. 保持应用运行 2 小时
2. 期间不断修改文件
3. 检查内存使用是否稳定

---

**测试完成后，请将结果反馈到项目 Issues！**

**祝测试愉快！** 🎉
