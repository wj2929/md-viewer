# MD Viewer v1.3.4 è®¾ç½®é¢æ¿ä¼˜åŒ–æ–¹æ¡ˆ

> æ–‡æ¡£ç‰ˆæœ¬: 1.0
> åˆ›å»ºæ—¥æœŸ: 2026-01-07
> çŠ¶æ€: âœ… å·²æ‰¹å‡†

---

## ä¸€ã€èƒŒæ™¯ä¸é—®é¢˜

### 1.1 å½“å‰çŠ¶æ€

v1.3.4 ç‰ˆæœ¬å®ç°äº†ç³»ç»Ÿå³é”®èœå•é›†æˆåŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥åœ¨ Finder ä¸­å³é”® .md æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©"ç”¨ MD Viewer æ‰“å¼€"ã€‚

### 1.2 æ ¸å¿ƒé—®é¢˜

**macOS ç‰¹æœ‰é™åˆ¶**ï¼šç”¨æˆ·é€šè¿‡åº”ç”¨å®‰è£…å³é”®èœå•åï¼Œè¿˜éœ€è¦æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤æ‰èƒ½ç”Ÿæ•ˆï¼š

```
ç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§ â†’ æ‰©å±• â†’ Finder æ‰©å±• â†’ å‹¾é€‰"ç”¨ MD Viewer æ‰“å¼€"
```

**é—®é¢˜ä¸¥é‡æ€§**ï¼š
- ç”¨æˆ·å®‰è£…åä¸çŸ¥é“éœ€è¦æ‰‹åŠ¨å¯ç”¨
- åœ¨ Finder ä¸­å³é”®çœ‹ä¸åˆ°èœå•é¡¹ï¼Œè¯¯ä»¥ä¸ºè½¯ä»¶æœ‰ Bug
- **é¢„ä¼°ç”¨æˆ·æµå¤±ç‡ï¼š60-80%**

### 1.3 å½“å‰è®¾ç½®é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾ç½®                            âœ•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ ç³»ç»Ÿé›†æˆ                            â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å³é”®èœå•                [å®‰è£…]  â”‚ â”‚
â”‚ â”‚ åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­å³é”® .md æ–‡ä»¶    â”‚ â”‚
â”‚ â”‚ æˆ–æ–‡ä»¶å¤¹                       â”‚ â”‚
â”‚ â”‚ æœªå®‰è£…                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**ï¼š
- âŒ ç•Œé¢ä¿¡æ¯ä¸è¶³ï¼Œæ²¡æœ‰ä½¿ç”¨è¯´æ˜
- âŒ å®‰è£…åæ²¡æœ‰æç¤ºç”¨æˆ·éœ€è¦æ‰‹åŠ¨å¯ç”¨
- âŒ æ²¡æœ‰æä¾›ä¾¿æ·çš„è·³è½¬ç³»ç»Ÿè®¾ç½®åŠŸèƒ½
- âŒ çŠ¶æ€æ˜¾ç¤ºè¿‡äºç®€å•

---

## äºŒã€ä¼˜åŒ–æ–¹æ¡ˆ

### 2.1 ä¼˜åŒ–ç›®æ ‡

1. **é™ä½ç”¨æˆ·æµå¤±ç‡** - é€šè¿‡æ¸…æ™°çš„å¼•å¯¼è®©ç”¨æˆ·å®Œæˆå®Œæ•´å®‰è£…æµç¨‹
2. **æå‡ç”¨æˆ·ä½“éªŒ** - æä¾›ä¾¿æ·çš„æ“ä½œå…¥å£å’Œä½¿ç”¨è¯´æ˜
3. **å¢å¼ºä¿¡æ¯åé¦ˆ** - è®©ç”¨æˆ·æ¸…æ¥šçŸ¥é“å½“å‰çŠ¶æ€å’Œä¸‹ä¸€æ­¥æ“ä½œ

### 2.2 ä¼˜å…ˆçº§åˆ’åˆ†

| ä¼˜å…ˆçº§ | åŠŸèƒ½ | æè¿° | å·¥æ—¶ | å¿…è¦æ€§ |
|--------|------|------|------|--------|
| **P0** | å®‰è£…æˆåŠŸå¼•å¯¼æ¨¡æ€æ¡† | å®‰è£…æˆåŠŸåå¼¹å‡ºï¼Œå‘ŠçŸ¥ç”¨æˆ·éœ€æ‰‹åŠ¨å¯ç”¨ | 2h | â­â­â­â­â­ |
| **P0** | æ‰“å¼€ç³»ç»Ÿè®¾ç½®æŒ‰é’® | ä¸€é”®è·³è½¬åˆ° Finder æ‰©å±•è®¾ç½®é¡µé¢ | 3h | â­â­â­â­â­ |
| **P0** | ç”¨æˆ·ç¡®è®¤æœºåˆ¶ | "æˆ‘å·²å¯ç”¨"æŒ‰é’®ï¼Œè®°å½•ç”¨æˆ·ç¡®è®¤çŠ¶æ€ | 2h | â­â­â­â­â­ |
| P1 | ä½¿ç”¨è¯´æ˜åŒºåŸŸ | å›¾æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨å³é”®èœå• | 2h | â­â­â­â­ |
| P2 | çŠ¶æ€è‡ªåŠ¨æ£€æµ‹ | âŒ ä¸æ¨èå®ç°ï¼ˆæŠ€æœ¯ä¸Šä¸å¯é ï¼‰ | - | - |

### 2.3 ä¼˜åŒ–åç•Œé¢è®¾è®¡

#### 2.3.1 é»˜è®¤çŠ¶æ€ï¼ˆæœªå®‰è£…ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾ç½®                                        âœ•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ç³»ç»Ÿé›†æˆ                                        â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”— å³é”®èœå•                                 â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ åœ¨ Finder ä¸­å³é”®æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œå¿«é€Ÿç”¨       â”‚ â”‚
â”‚ â”‚ MD Viewer æ‰“å¼€ã€‚                            â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ çŠ¶æ€ï¼šâšª æœªå®‰è£…                             â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚                              [å®‰è£…å³é”®èœå•] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ ğŸ“– ä½¿ç”¨è¯´æ˜                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å®‰è£…åï¼Œåœ¨ Finder ä¸­ï¼š                      â”‚ â”‚
â”‚ â”‚ 1. å³é”®ç‚¹å‡» .md æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹               â”‚ â”‚
â”‚ â”‚ 2. é€‰æ‹©ã€Œå¿«é€Ÿæ“ä½œã€â†’ã€Œç”¨ MD Viewer æ‰“å¼€ã€  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.2 å®‰è£…æˆåŠŸå¼•å¯¼æ¨¡æ€æ¡†ï¼ˆP0 æ ¸å¿ƒï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚              âœ… å³é”®èœå•å®‰è£…æˆåŠŸï¼               â”‚
â”‚                                                 â”‚
â”‚  âš ï¸ é‡è¦ï¼šéœ€è¦åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¯ç”¨                  â”‚
â”‚                                                 â”‚
â”‚  macOS è¦æ±‚ç”¨æˆ·æ‰‹åŠ¨æˆæƒ Finder æ‰©å±•ï¼Œ          â”‚
â”‚  è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š                             â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ­¥éª¤ 1: ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰“å¼€ç³»ç»Ÿè®¾ç½®        â”‚   â”‚
â”‚  â”‚ æ­¥éª¤ 2: æ‰¾åˆ°ã€Œç”¨ MD Viewer æ‰“å¼€ã€       â”‚   â”‚
â”‚  â”‚ æ­¥éª¤ 3: å‹¾é€‰å¯ç”¨                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚        [æ‰“å¼€ç³»ç»Ÿè®¾ç½®]    [æˆ‘å·²å®Œæˆå¯ç”¨]         â”‚
â”‚                                                 â”‚
â”‚                    ç¨åè®¾ç½®                     â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.3 å·²å®‰è£…å¾…å¯ç”¨çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾ç½®                                        âœ•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ç³»ç»Ÿé›†æˆ                                        â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”— å³é”®èœå•                                 â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ çŠ¶æ€ï¼šğŸŸ¡ å·²å®‰è£…ï¼Œå¾…å¯ç”¨                     â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ âš ï¸ è¯·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¯ç”¨ Finder æ‰©å±•          â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ [æ‰“å¼€ç³»ç»Ÿè®¾ç½®]  [æˆ‘å·²å¯ç”¨]  [å¸è½½]          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.4 å·²å¯ç”¨çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾ç½®                                        âœ•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ç³»ç»Ÿé›†æˆ                                        â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”— å³é”®èœå•                                 â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ çŠ¶æ€ï¼šğŸŸ¢ å·²å¯ç”¨                             â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ âœ“ å¯åœ¨ Finder ä¸­å³é”®ä½¿ç”¨                   â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚                                    [å¸è½½]   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 3.1 æ–‡ä»¶ä¿®æ”¹æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| `src/main/index.ts` | ä¿®æ”¹ | æ–°å¢ `system:openSettings` IPC æ¥å£ |
| `src/preload/index.ts` | ä¿®æ”¹ | æš´éœ² `openSystemSettings` API |
| `src/preload/index.d.ts` | ä¿®æ”¹ | æ·»åŠ ç±»å‹å®šä¹‰ |
| `src/renderer/src/components/SettingsPanel.tsx` | é‡æ„ | å®ç°å®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ |
| `src/renderer/src/assets/main.css` | ä¿®æ”¹ | æ–°å¢æ ·å¼ |

### 3.2 IPC æ¥å£è®¾è®¡

#### 3.2.1 æ–°å¢æ¥å£ï¼š`system:openSettings`

**æ–‡ä»¶**ï¼š`src/main/index.ts`

```typescript
import { shell } from 'electron'

// æ‰“å¼€ç³»ç»Ÿè®¾ç½®
ipcMain.handle('system:openSettings', async (_event, section: string) => {
  try {
    if (process.platform === 'darwin') {
      // macOS ç³»ç»Ÿè®¾ç½®æ·±åº¦é“¾æ¥
      const urlMap: Record<string, string> = {
        'extensions': 'x-apple.systempreferences:com.apple.preferences.extensions',
        'finder-extensions': 'x-apple.systempreferences:com.apple.preferences.extensions?Finder',
        'security': 'x-apple.systempreferences:com.apple.preference.security'
      }
      const url = urlMap[section] || urlMap['extensions']
      await shell.openExternal(url)
      return { success: true }
    } else if (process.platform === 'win32') {
      // Windows é»˜è®¤ç¨‹åºè®¾ç½®
      await shell.openExternal('ms-settings:defaultapps')
      return { success: true }
    }
    return { success: false, error: 'ä¸æ”¯æŒçš„å¹³å°' }
  } catch (error) {
    console.error('[System] Failed to open settings:', error)
    return { success: false, error: String(error) }
  }
})
```

#### 3.2.2 Preload æš´éœ²

**æ–‡ä»¶**ï¼š`src/preload/index.ts`

```typescript
// åœ¨ api å¯¹è±¡ä¸­æ·»åŠ 
openSystemSettings: (section: string) =>
  ipcRenderer.invoke('system:openSettings', section) as Promise<{
    success: boolean
    error?: string
  }>
```

#### 3.2.3 ç±»å‹å®šä¹‰

**æ–‡ä»¶**ï¼š`src/preload/index.d.ts`

```typescript
// åœ¨ Window.api æ¥å£ä¸­æ·»åŠ 
openSystemSettings: (section: string) => Promise<{
  success: boolean
  error?: string
}>
```

### 3.3 çŠ¶æ€ç®¡ç†è®¾è®¡

#### 3.3.1 çŠ¶æ€ç±»å‹æ‰©å±•

```typescript
interface ContextMenuStatus {
  installed: boolean          // æ˜¯å¦å·²å®‰è£… workflow
  platform: string            // å¹³å°ï¼šdarwin | win32 | linux
  installedAt?: number        // å®‰è£…æ—¶é—´æˆ³
  userConfirmedEnabled?: boolean  // ç”¨æˆ·æ˜¯å¦ç¡®è®¤å·²å¯ç”¨ï¼ˆæ–°å¢ï¼‰
}
```

#### 3.3.2 çŠ¶æ€æµè½¬å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æœªå®‰è£…    â”‚
                    â”‚ (installed: â”‚
                    â”‚   false)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ ç‚¹å‡»å®‰è£…
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ å®‰è£…æˆåŠŸ    â”‚
                    â”‚ å¼¹å‡ºå¼•å¯¼æ¡†  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚            â”‚            â”‚
              â–¼            â–¼            â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚æ‰“å¼€ç³»ç»Ÿ  â”‚ â”‚ æˆ‘å·²å¯ç”¨ â”‚ â”‚ ç¨åè®¾ç½® â”‚
       â”‚  è®¾ç½®    â”‚ â”‚          â”‚ â”‚          â”‚
       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚            â”‚            â”‚
            â–¼            â–¼            â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚å·²å®‰è£…    â”‚ â”‚ å·²å¯ç”¨   â”‚ â”‚å·²å®‰è£…    â”‚
       â”‚å¾…å¯ç”¨    â”‚ â”‚          â”‚ â”‚å¾…å¯ç”¨    â”‚
       â”‚(é»„è‰²)    â”‚ â”‚(ç»¿è‰²)    â”‚ â”‚(é»„è‰²)    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 SettingsPanel ç»„ä»¶é‡æ„

#### 3.4.1 ç»„ä»¶çŠ¶æ€

```typescript
interface SettingsPanelState {
  status: ContextMenuStatus | null  // å³é”®èœå•çŠ¶æ€
  loading: boolean                   // åŠ è½½ä¸­
  showEnableGuide: boolean           // æ˜¾ç¤ºå¯ç”¨å¼•å¯¼æ¨¡æ€æ¡†
}
```

#### 3.4.2 æ ¸å¿ƒé€»è¾‘

```typescript
export const SettingsPanel: React.FC<{ onClose: () => void }> = ({ onClose }) => {
  const [status, setStatus] = useState<ContextMenuStatus | null>(null)
  const [loading, setLoading] = useState(false)
  const [showEnableGuide, setShowEnableGuide] = useState(false)

  // å®‰è£…å¤„ç†
  const handleInstall = async () => {
    setLoading(true)
    try {
      const result = await window.api.installContextMenu()
      if (result.success) {
        await loadStatus()
        // ğŸ†• å®‰è£…æˆåŠŸåæ˜¾ç¤ºå¼•å¯¼
        if (status?.platform === 'darwin') {
          setShowEnableGuide(true)
        }
      } else {
        alert(`å®‰è£…å¤±è´¥: ${result.error}`)
      }
    } finally {
      setLoading(false)
    }
  }

  // æ‰“å¼€ç³»ç»Ÿè®¾ç½®
  const handleOpenSystemSettings = async () => {
    const result = await window.api.openSystemSettings('finder-extensions')
    if (!result.success) {
      alert('æ— æ³•æ‰“å¼€ç³»ç»Ÿè®¾ç½®ï¼Œè¯·æ‰‹åŠ¨å‰å¾€ï¼š\nç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§ â†’ æ‰©å±• â†’ Finder æ‰©å±•')
    }
  }

  // ç”¨æˆ·ç¡®è®¤å·²å¯ç”¨
  const handleConfirmEnabled = async () => {
    // æ›´æ–°çŠ¶æ€åˆ° electron-store
    await window.api.confirmContextMenuEnabled()
    await loadStatus()
    setShowEnableGuide(false)
  }

  // è·å–æ˜¾ç¤ºçŠ¶æ€
  const getDisplayStatus = () => {
    if (!status?.installed) {
      return { icon: 'âšª', text: 'æœªå®‰è£…', color: 'gray' }
    }
    if (status.platform === 'darwin' && !status.userConfirmedEnabled) {
      return { icon: 'ğŸŸ¡', text: 'å·²å®‰è£…ï¼Œå¾…å¯ç”¨', color: 'yellow' }
    }
    return { icon: 'ğŸŸ¢', text: 'å·²å¯ç”¨', color: 'green' }
  }

  // ... æ¸²æŸ“é€»è¾‘
}
```

### 3.5 æ ·å¼è®¾è®¡

```css
/* è®¾ç½®é¢æ¿ä¼˜åŒ–æ ·å¼ */
.settings-panel {
  width: 480px;
  max-height: 80vh;
  overflow-y: auto;
}

/* çŠ¶æ€æŒ‡ç¤ºå™¨ */
.status-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 14px;
}

.status-indicator.gray {
  background: #f0f0f0;
  color: #666;
}

.status-indicator.yellow {
  background: #fff3cd;
  color: #856404;
}

.status-indicator.green {
  background: #d4edda;
  color: #155724;
}

/* å¼•å¯¼æ¨¡æ€æ¡† */
.enable-guide-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1001;
}

.enable-guide-content {
  background: white;
  border-radius: 12px;
  padding: 24px;
  max-width: 420px;
  text-align: center;
}

.enable-guide-steps {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 16px;
  margin: 16px 0;
  text-align: left;
}

.enable-guide-steps ol {
  margin: 0;
  padding-left: 20px;
}

.enable-guide-steps li {
  margin: 8px 0;
  color: #333;
}

.enable-guide-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 20px;
}

.btn-primary {
  background: #007AFF;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
}

.btn-secondary {
  background: #f0f0f0;
  color: #333;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
}

.btn-link {
  background: none;
  border: none;
  color: #666;
  cursor: pointer;
  font-size: 13px;
  margin-top: 12px;
}

/* ä½¿ç”¨è¯´æ˜åŒºåŸŸ */
.usage-instructions {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 16px;
  margin-top: 16px;
}

.usage-instructions h4 {
  margin: 0 0 12px 0;
  font-size: 14px;
  color: #333;
}

.usage-instructions ol {
  margin: 0;
  padding-left: 20px;
  color: #666;
  font-size: 13px;
}

.usage-instructions li {
  margin: 6px 0;
}
```

---

## å››ã€æµ‹è¯•æ–¹æ¡ˆ

### 4.1 å•å…ƒæµ‹è¯•

```typescript
// src/renderer/test/components/SettingsPanel.test.tsx

describe('SettingsPanel - å³é”®èœå•å®‰è£…æµç¨‹', () => {
  beforeEach(() => {
    vi.mocked(window.api.checkContextMenuStatus).mockResolvedValue({
      installed: false,
      platform: 'darwin'
    })
  })

  it('å®‰è£…æˆåŠŸååº”æ˜¾ç¤ºå¯ç”¨å¼•å¯¼æ¨¡æ€æ¡†ï¼ˆmacOSï¼‰', async () => {
    vi.mocked(window.api.installContextMenu).mockResolvedValue({ success: true })
    vi.mocked(window.api.checkContextMenuStatus).mockResolvedValue({
      installed: true,
      platform: 'darwin'
    })

    render(<SettingsPanel onClose={vi.fn()} />)

    await userEvent.click(screen.getByText('å®‰è£…å³é”®èœå•'))

    await waitFor(() => {
      expect(screen.getByText('å³é”®èœå•å®‰è£…æˆåŠŸï¼')).toBeInTheDocument()
      expect(screen.getByText('æ‰“å¼€ç³»ç»Ÿè®¾ç½®')).toBeInTheDocument()
      expect(screen.getByText('æˆ‘å·²å®Œæˆå¯ç”¨')).toBeInTheDocument()
    })
  })

  it('ç‚¹å‡»"æ‰“å¼€ç³»ç»Ÿè®¾ç½®"åº”è°ƒç”¨æ­£ç¡®çš„ API', async () => {
    vi.mocked(window.api.openSystemSettings).mockResolvedValue({ success: true })

    // ... è§¦å‘æ˜¾ç¤ºæ¨¡æ€æ¡†

    await userEvent.click(screen.getByText('æ‰“å¼€ç³»ç»Ÿè®¾ç½®'))

    expect(window.api.openSystemSettings).toHaveBeenCalledWith('finder-extensions')
  })

  it('ç‚¹å‡»"æˆ‘å·²å®Œæˆå¯ç”¨"åº”æ›´æ–°çŠ¶æ€', async () => {
    vi.mocked(window.api.confirmContextMenuEnabled).mockResolvedValue({ success: true })

    // ... è§¦å‘æ˜¾ç¤ºæ¨¡æ€æ¡†

    await userEvent.click(screen.getByText('æˆ‘å·²å®Œæˆå¯ç”¨'))

    expect(window.api.confirmContextMenuEnabled).toHaveBeenCalled()
    expect(screen.queryByText('å³é”®èœå•å®‰è£…æˆåŠŸï¼')).not.toBeInTheDocument()
  })

  it('å·²å®‰è£…å¾…å¯ç”¨çŠ¶æ€åº”æ˜¾ç¤ºé»„è‰²æŒ‡ç¤ºå™¨', async () => {
    vi.mocked(window.api.checkContextMenuStatus).mockResolvedValue({
      installed: true,
      platform: 'darwin',
      userConfirmedEnabled: false
    })

    render(<SettingsPanel onClose={vi.fn()} />)

    await waitFor(() => {
      expect(screen.getByText('å·²å®‰è£…ï¼Œå¾…å¯ç”¨')).toBeInTheDocument()
    })
  })

  it('å·²å¯ç”¨çŠ¶æ€åº”æ˜¾ç¤ºç»¿è‰²æŒ‡ç¤ºå™¨', async () => {
    vi.mocked(window.api.checkContextMenuStatus).mockResolvedValue({
      installed: true,
      platform: 'darwin',
      userConfirmedEnabled: true
    })

    render(<SettingsPanel onClose={vi.fn()} />)

    await waitFor(() => {
      expect(screen.getByText('å·²å¯ç”¨')).toBeInTheDocument()
    })
  })
})
```

### 4.2 E2E æµ‹è¯•

```typescript
// e2e/settings-panel.spec.ts

import { test, expect } from '@playwright/test'

test.describe('è®¾ç½®é¢æ¿ - å³é”®èœå•', () => {
  test('å®Œæ•´å®‰è£…æµç¨‹', async ({ page }) => {
    // æ‰“å¼€åº”ç”¨
    await page.goto('/')

    // æ‰“å¼€è®¾ç½®é¢æ¿
    await page.click('[data-testid="settings-button"]')

    // éªŒè¯åˆå§‹çŠ¶æ€
    await expect(page.locator('text=æœªå®‰è£…')).toBeVisible()

    // ç‚¹å‡»å®‰è£…
    await page.click('text=å®‰è£…å³é”®èœå•')

    // éªŒè¯å¼•å¯¼æ¨¡æ€æ¡†
    await expect(page.locator('text=å³é”®èœå•å®‰è£…æˆåŠŸï¼')).toBeVisible()
    await expect(page.locator('text=æ‰“å¼€ç³»ç»Ÿè®¾ç½®')).toBeVisible()

    // ç‚¹å‡»"æˆ‘å·²å®Œæˆå¯ç”¨"
    await page.click('text=æˆ‘å·²å®Œæˆå¯ç”¨')

    // éªŒè¯çŠ¶æ€æ›´æ–°
    await expect(page.locator('text=å·²å¯ç”¨')).toBeVisible()
  })
})
```

---

## äº”ã€é£é™©è¯„ä¼°

### 5.1 æŠ€æœ¯é£é™©

| é£é™© | çº§åˆ« | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| macOS æ·±åº¦é“¾æ¥å¤±æ•ˆ | ğŸŸ¡ ä¸­ | æ— æ³•è‡ªåŠ¨è·³è½¬ç³»ç»Ÿè®¾ç½® | æä¾›æ‰‹åŠ¨è·¯å¾„è¯´æ˜ä½œä¸ºé™çº§æ–¹æ¡ˆ |
| ç”¨æˆ·ä¸ç‚¹å‡»ç¡®è®¤æŒ‰é’® | ğŸŸ¢ ä½ | çŠ¶æ€æ˜¾ç¤ºä¸å‡†ç¡® | ä¸å½±å“åŠŸèƒ½ä½¿ç”¨ï¼Œä»…å½±å“æ˜¾ç¤º |
| electron-store å­˜å‚¨å¤±è´¥ | ğŸŸ¢ ä½ | ç¡®è®¤çŠ¶æ€ä¸¢å¤± | ä½¿ç”¨ try-catch å¤„ç†ï¼Œå¤±è´¥æ—¶é™çº§ |

### 5.2 å…¼å®¹æ€§é£é™©

| å¹³å° | é£é™©çº§åˆ« | è¯´æ˜ |
|------|----------|------|
| macOS 12+ | ğŸŸ¢ ä½ | æ·±åº¦é“¾æ¥ç¨³å®š |
| macOS 11 | ğŸŸ¡ ä¸­ | æ·±åº¦é“¾æ¥å¯èƒ½ä¸åŒï¼Œéœ€æµ‹è¯• |
| Windows | ğŸŸ¢ ä½ | ä¸éœ€è¦äºŒæ¬¡å¯ç”¨ |
| Linux | ğŸŸ¢ ä½ | ä¸éœ€è¦äºŒæ¬¡å¯ç”¨ |

### 5.3 ä¸æ¨èå®ç°çš„åŠŸèƒ½

âŒ **çŠ¶æ€è‡ªåŠ¨æ£€æµ‹**

åŸå› ï¼š
1. macOS æ— å…¬å¼€ API æ£€æµ‹ Finder æ‰©å±•å¯ç”¨çŠ¶æ€
2. ä½¿ç”¨ç§æœ‰ API (`pluginkit`) è¿å App Store å®¡æ ¸è§„åˆ™
3. æ²™ç®±æ¨¡å¼ä¸‹æ— æ³•è¯»å–ç³»ç»Ÿæ‰©å±•é…ç½®

æ›¿ä»£æ–¹æ¡ˆï¼šé‡‡ç”¨ç”¨æˆ·ç¡®è®¤æœºåˆ¶

---

## å…­ã€å®æ–½è®¡åˆ’

### 6.1 é˜¶æ®µåˆ’åˆ†

#### é˜¶æ®µä¸€ï¼šP0 åŠŸèƒ½ï¼ˆé¢„è®¡ 7 å°æ—¶ï¼‰

- [ ] æ–°å¢ `system:openSettings` IPC æ¥å£
- [ ] æ›´æ–° preload å±‚
- [ ] å®ç°å®‰è£…æˆåŠŸå¼•å¯¼æ¨¡æ€æ¡†
- [ ] å®ç°"æ‰“å¼€ç³»ç»Ÿè®¾ç½®"åŠŸèƒ½
- [ ] å®ç°ç”¨æˆ·ç¡®è®¤æœºåˆ¶
- [ ] æ·»åŠ çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼

#### é˜¶æ®µäºŒï¼šP1 åŠŸèƒ½ï¼ˆé¢„è®¡ 4 å°æ—¶ï¼‰

- [ ] æ·»åŠ ä½¿ç”¨è¯´æ˜åŒºåŸŸ
- [ ] ä¼˜åŒ–æ•´ä½“è§†è§‰è®¾è®¡
- [ ] è¡¥å……å•å…ƒæµ‹è¯•

### 6.2 éªŒæ”¶æ ‡å‡†

1. âœ… å®‰è£…æˆåŠŸåè‡ªåŠ¨å¼¹å‡ºå¼•å¯¼æ¨¡æ€æ¡†
2. âœ… ç‚¹å‡»"æ‰“å¼€ç³»ç»Ÿè®¾ç½®"èƒ½æ­£ç¡®è·³è½¬
3. âœ… ç‚¹å‡»"æˆ‘å·²å®Œæˆå¯ç”¨"èƒ½æ›´æ–°çŠ¶æ€æ˜¾ç¤º
4. âœ… ä¸‰ç§çŠ¶æ€ï¼ˆæœªå®‰è£…/å¾…å¯ç”¨/å·²å¯ç”¨ï¼‰æ˜¾ç¤ºæ­£ç¡®
5. âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
6. âœ… Windows/Linux å¹³å°ä¸æ˜¾ç¤º macOS ç‰¹æœ‰çš„å¯ç”¨å¼•å¯¼

---

## ä¸ƒã€é™„å½•

### 7.1 macOS ç³»ç»Ÿè®¾ç½®æ·±åº¦é“¾æ¥å‚è€ƒ

```
ç³»ç»Ÿåå¥½è®¾ç½®ï¼ˆæ—§ç‰ˆï¼‰: x-apple.systempreferences:
ç³»ç»Ÿè®¾ç½®ï¼ˆæ–°ç‰ˆï¼‰: x-apple.systempreferences:

æ‰©å±•: x-apple.systempreferences:com.apple.preferences.extensions
å®‰å…¨æ€§ä¸éšç§: x-apple.systempreferences:com.apple.preference.security
éšç§-å®Œå…¨ç£ç›˜è®¿é—®: x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles
```

### 7.2 ç›¸å…³æ–‡ä»¶è·¯å¾„

```
ä¸»è¿›ç¨‹: src/main/index.ts
é¢„åŠ è½½: src/preload/index.ts
ç±»å‹å®šä¹‰: src/preload/index.d.ts
è®¾ç½®é¢æ¿: src/renderer/src/components/SettingsPanel.tsx
æ ·å¼æ–‡ä»¶: src/renderer/src/assets/main.css
```

---

## å…«ã€å®¡æ‰¹è®°å½•

| æ—¥æœŸ | å®¡æ‰¹äºº | ç»“æœ | å¤‡æ³¨ |
|------|--------|------|------|
| 2026-01-07 | architect-review agent | âœ… æ‰¹å‡† | P0 åŠŸèƒ½å¿…é¡»ç«‹å³å®ç° |

---

> æ–‡æ¡£ç»“æŸ
