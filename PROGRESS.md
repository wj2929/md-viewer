# MD Viewer 进度追踪

> Markdown 预览器项目进度状态
> **最后更新：2026-01-03 22:00** ✅ **v1.2.0 已发布 + v1.2.1 优化完成**

---

## 📋 **当前状态：v1.2.1 优化完成**

| 指标 | 状态 |
|------|------|
| **当前版本** | v1.2.0 ✅ **已发布** |
| **优化版本** | v1.2.1（快捷键 + E2E + 测试扩展）✅ |
| **测试数量** | 312 个单元测试 (312 通过, 0 失败) ✅ |
| **测试覆盖率** | 58.46%（结构调整后重新计算）|
| **安全状态** | ✅ 路径校验 + 沙箱已启用 |
| **当前分支** | `main` |
| **下一步** | 可选：E2E 实际运行、继续优化覆盖率 |

---

## ✅ **v1.2.1 优化完成（2026-01-03 22:00）**

### 全局快捷键 ✅
- ✅ `⌘/Ctrl + O` - 打开文件夹
- ✅ `⌘/Ctrl + R` - 刷新文件树
- ✅ `⌘/Ctrl + W` - 关闭当前标签
- ✅ `⌘/Ctrl + E` - 导出 HTML
- ✅ `⌘/Ctrl + Shift + E` - 导出 PDF
- ✅ `⌘/Ctrl + F` - 聚焦搜索栏
- ✅ `⌘/Ctrl + Tab` - 下一个标签
- ✅ `⌘/Ctrl + Shift + Tab` - 上一个标签
- ✅ `⌘/Ctrl + 1-5` - 切换到指定标签

### E2E 测试完善 ✅
- ✅ Playwright fixture 增强（testDir、openFolderViaIPC）
- ✅ 应用启动测试（主题切换）
- ✅ 文件树功能测试
- ✅ Markdown 渲染测试
- ✅ 键盘快捷键测试（新增）

### App.tsx 集成测试 ✅
- ✅ 28 个测试用例
- ✅ 快捷键事件监听器测试
- ✅ 右键菜单事件测试
- ✅ 剪贴板事件测试
- ✅ 状态恢复测试
- ✅ 边界条件测试

---

## ✅ **v1.2.0 发布（2026-01-03 21:36）**

### 阶段 0：安全加固 ✅
- ✅ 路径白名单校验
- ✅ 受保护路径黑名单
- ✅ 启用沙箱模式 `sandbox: true`
- ✅ 安全测试 27/27 通过

### 阶段 1：右键菜单 ✅
- ✅ Electron 原生 Menu
- ✅ 在 Finder 中显示 / 复制路径
- ✅ 导出 HTML/PDF
- ✅ Inline Editing 重命名
- ✅ 删除（移到回收站）
- ✅ 刷新按钮

### 阶段 2：应用内剪贴板 ✅
- ✅ Zustand 状态管理
- ✅ 复制/剪切/粘贴文件
- ✅ 剪切状态可视化
- ✅ 文件夹递归复制

### 阶段 3：测试覆盖率 ✅
- ✅ 新增 120+ 测试用例
- ✅ 关键模块 100% 覆盖

### 阶段 4：虚拟滚动 ✅
- ✅ 安装 react-virtuoso
- ✅ 创建 VirtualizedMarkdown 组件
- ✅ 智能分段（按标题 + 100 行限制）

### 阶段 5：主题切换 UI ✅
- ✅ useTheme Hook（自动/亮/暗）
- ✅ ThemeToggle 组件（标题栏右侧）
- ✅ localStorage 持久化

---

## 📊 **Git 提交记录**

```
326b826 feat(v1.2.1): 全局快捷键 + E2E测试 + 集成测试扩展
f7a3c0b chore: bump version to 1.2.0
xxxxxxx Merge branch 'feature/v1.2-security-hardening' - v1.2.0 发布
1b87db8 feat(v1.2): 阶段 3-5 完成 - 测试覆盖率、虚拟滚动、主题切换
cd816e0 feat(clipboard): 阶段 2 完成 - 应用内剪贴板全功能实现
a7a093a feat(clipboard): 阶段 2 - 应用内剪贴板基础架构
d0bd833 test(context-menu): 添加 contextMenuHandler 完整测试套件
83784d3 feat(context-menu): 阶段 1 - 右键菜单完成
3503aa6 feat(security): 阶段 0 - 安全加固完成
```

---

## 🚀 **v1.2 功能总览**

| 功能 | 描述 | 状态 |
|------|------|------|
| 安全加固 | 路径校验 + 沙箱 | ✅ |
| 右键菜单 | Electron 原生 Menu | ✅ |
| Inline 重命名 | 双击或右键重命名 | ✅ |
| Toast 通知 | 替代 alert | ✅ |
| 应用内剪贴板 | Zustand 管理 | ✅ |
| 虚拟滚动 | react-virtuoso | ✅ |
| 主题切换 | 自动/亮/暗 三档 | ✅ |
| **全局快捷键** | **10+ 快捷键** | ✅ **v1.2.1** |

---

## 📊 **测试统计**

```
渲染进程测试：257/257 通过 ✅
主进程测试：  55/55  通过 ✅
─────────────────────────────────
总计：       312/312 通过 ✅
```

**v1.2.1 新增/更新测试**：
- App.test.tsx 扩展（28 测试）
- 06-keyboard-shortcuts.spec.ts（E2E）
- E2E fixture 增强

---

## 📁 **v1.2.1 新增/修改文件**

```
新增文件：
├── src/main/shortcuts.ts                    # 快捷键模块
└── e2e/06-keyboard-shortcuts.spec.ts        # 快捷键 E2E 测试

修改文件：
├── src/main/index.ts                        # 注册快捷键
├── src/preload/index.ts                     # 快捷键事件 API
├── src/preload/index.d.ts                   # 类型定义
├── src/renderer/src/App.tsx                 # 快捷键处理
├── src/renderer/src/components/SearchBar.tsx # forwardRef 支持
├── e2e/fixtures/electron.ts                 # E2E fixture 增强
└── src/renderer/test/App.test.tsx           # 扩展集成测试
```

---

## 📝 **下一步行动**

### 可选优化
- ⏳ 运行 E2E 测试（需要构建后运行）
- ⏳ 提升 VirtualizedMarkdown 覆盖率
- ⏳ 添加更多快捷键（全选、撤销等）

---

## 📊 **版本规划**

| 版本 | 核心功能 | 状态 |
|------|----------|------|
| v1.0 | 纯预览器 | ✅ 完成 |
| v1.1 | Mermaid + 文件监听 | ✅ 完成 |
| v1.1.1 | Bug修复 | ✅ 完成 |
| v1.1.2 | KaTeX/Mermaid 修复 | ✅ 完成 |
| **v1.2.0** | **安全 + 右键 + 剪贴板 + 虚拟滚动 + 主题** | ✅ **已发布** |
| **v1.2.1** | **快捷键 + E2E + 测试扩展** | ✅ **完成** |
| v1.3 | 跨应用剪贴板 + 多文件选择 | 未开始 |
| v2.0 | 插件系统 | 未开始 |

---

## 📅 **变更历史**

| 日期 | 时间 | 变更内容 |
|------|------|----------|
| 2026-01-02 | 14:00 | 项目初始化 |
| 2026-01-02 | 23:00 | v1.0.0 发布 |
| 2026-01-03 | 07:00 | v1.1.0 发布 |
| 2026-01-03 | 17:00 | v1.1.1 发布 |
| 2026-01-03 | 18:30 | v1.1.2 发布 |
| 2026-01-03 | 21:36 | **v1.2.0 发布** ✅ |
| **2026-01-03** | **22:00** | **v1.2.1 优化完成** ✅ |

---

**更新频率**：实时更新
**维护者**：wj2929
**当前状态**：✅ **v1.2.0 已发布，v1.2.1 优化完成（312 测试通过）**
