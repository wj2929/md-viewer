# MD Viewer 进度追踪

> Markdown 预览器项目进度状态
> **最后更新：2026-01-04 13:10** ✅ **v1.3.1 样式优化完成**

---

## 📋 **当前状态：v1.3.1 样式优化完成**

| 指标 | 状态 |
|------|------|
| **当前版本** | v1.2.0 ✅ **已发布** |
| **开发版本** | v1.3.0 ✅ **全部 8 个阶段完成** |
| **样式优化** | v1.3.1 ✅ **MPE GitHub 主题移植完成** |
| **测试数量** | 452 个单元测试 (452 通过, 0 失败) ✅ |
| **测试覆盖率** | 71.71%（目标 70%）✅ |
| **安全状态** | ✅ 路径校验 + 沙箱 + 45 条保护规则 |
| **当前分支** | `feature/v1.3` |
| **下一步** | 合并到 main，发布 v1.3.0 |

---

## 🚀 **v1.3 开发进度（2026-01-04）**

### **阶段进度 - 全部完成**

| 阶段 | 功能 | 状态 | 新增测试 | 提交 |
|------|------|------|----------|------|
| 阶段 0 | 安全加固 + 文件监听修复 | ✅ 完成 | +16 | `36450a9` |
| 阶段 1 | Tab 右键菜单 | ✅ 完成 | +15 | `ecd49d5` |
| 阶段 2 | Markdown 右键菜单 | ✅ 完成 | +12 | `9e79a07` |
| 阶段 3 | 重构剪贴板架构 | ✅ 完成 | - | `2e767f2` |
| 阶段 4 | 优化虚拟滚动 CSS | ✅ 完成 | - | `693d239` |
| 阶段 5 | 多文件选择 | ✅ 完成 | +4 | `d836607` |
| 阶段 6 | 跨应用剪贴板 | ✅ 完成 | +27 | `eb6b167` |
| 阶段 7 | 测试覆盖率 70%+ | ✅ 完成 | +66 | `abb14b0` |

### **额外修复（2026-01-04 12:00）**

| 修复项 | 描述 | 状态 |
|--------|------|------|
| 文件监听 Bug | 简化为只监听当前打开文件所在目录，避免 EMFILE | ✅ |
| 虚拟滚动 Bug | 禁用虚拟滚动（分段渲染存在问题）| ✅ |
| 侧边栏宽度 | 新增可拖拽分隔条，支持 180-500px 调整 | ✅ |

### **样式优化（2026-01-04 13:10）**

| 优化项 | 描述 | 状态 |
|--------|------|------|
| Markdown 样式 | 移植 MPE (Markdown Preview Enhanced) GitHub 主题 | ✅ |
| 引用块样式 | 浅灰背景 + 4px 左边框 | ✅ |
| 表格样式 | 有外边框 + 自适应宽度 + 表头背景 | ✅ |
| 代码块样式 | GitHub 风格配色 + 边框 | ✅ |
| 分隔线样式 | 1px 细淡分隔线 | ✅ |
| 标题样式 | H1/H2 无下划线（与 MPE 一致）| ✅ |

---

### **已完成功能详情**

#### 阶段 0：安全加固 + 文件监听增强 ✅
- ✅ PROTECTED_PATTERNS 扩展到 45+ 条规则
- ✅ 新增保护：Docker/Azure/GCloud/GitHub CLI 配置
- ✅ 新增保护：.env/.npmrc/.pypirc/.git-credentials
- ✅ 新增保护：SSH/证书私钥 (pem/p12/pfx/key/jks)
- ✅ 文件监听：新增 add/addDir/unlinkDir/rename 事件
- ✅ 500ms 时间窗口重命名检测机制

#### 阶段 1：Tab 右键菜单 ✅
- ✅ 菜单项：关闭、关闭其他、关闭所有
- ✅ 菜单项：关闭左侧、关闭右侧
- ✅ 菜单项：在 Finder 中显示、复制路径
- ✅ 菜单项根据 Tab 位置动态启用/禁用

#### 阶段 2：Markdown 右键菜单 ✅
- ✅ 菜单项：导出 HTML (Cmd+E)、导出 PDF (Cmd+Shift+E)
- ✅ 菜单项：复制为 Markdown、纯文本、HTML
- ✅ 有选中内容时显示"复制选中内容"
- ✅ 移除预览区顶部导出按钮

#### 阶段 3：重构剪贴板架构 ✅
- ✅ 渲染进程 clipboardStore 作为唯一数据源
- ✅ 主进程仅作为状态镜像
- ✅ 事务性粘贴：部分失败不丢失数据
- ✅ 右键菜单动态控制粘贴菜单启用状态

#### 阶段 4：优化虚拟滚动 ✅
- ✅ CSS 调整消除分段间隔
- ⚠️ 后续禁用虚拟滚动（分段渲染存在 Bug）

#### 阶段 5：多文件选择 ✅
- ✅ Cmd+点击 切换单个文件选择
- ✅ Shift+点击 范围选择
- ✅ Cmd+A 全选当前目录
- ✅ Escape 清除选择
- ✅ 选中文件高亮样式

#### 阶段 6：跨应用剪贴板 ✅
- ✅ 系统剪贴板读取（macOS/Windows/Linux）
- ✅ 系统剪贴板写入
- ✅ 主进程安全过滤（isProtectedPath）
- ✅ 27 个测试用例

#### 阶段 7：测试覆盖率 70%+ ✅
- ✅ VirtualizedMarkdown 测试：39 个用例
- ✅ clipboardManager 测试：27 个用例
- ✅ FileTree 多选测试：4 个用例
- ✅ 覆盖率：54.57% → 71.71%

---

## 📊 **测试统计**

```
渲染进程测试：300/300 通过 ✅ (+43 新增)
主进程测试：  152/152 通过 ✅ (+54 新增)
─────────────────────────────────────
总计：       452/452 通过 ✅
覆盖率：     71.71%（目标 70%）✅
```

---

## 📊 **Git 提交记录（v1.3 分支）**

```
abb14b0 feat(v1.3): 阶段 7 - 测试覆盖率提升至 70%+
eb6b167 feat(v1.3): 阶段 6 - 跨应用剪贴板支持
d836607 feat(v1.3): 阶段 5 - 多文件选择支持
693d239 feat(v1.3): 阶段 4 - 优化虚拟滚动 CSS
2e767f2 feat(v1.3): 阶段 3 - 重构剪贴板架构（单一数据源）
9e79a07 feat(v1.3): 阶段 2 - Markdown 内容区右键菜单
ecd49d5 feat(v1.3): 阶段 1 - Tab 右键菜单
36450a9 feat(v1.3): 阶段 0 - 安全加固 + 文件监听增强
```

---

## 🚀 **功能总览**

| 功能 | 描述 | 版本 | 状态 |
|------|------|------|------|
| 安全加固 | 路径校验 + 沙箱 | v1.2.0 | ✅ |
| 右键菜单 | Electron 原生 Menu | v1.2.0 | ✅ |
| 应用内剪贴板 | Zustand 管理 | v1.2.0 | ✅ |
| 虚拟滚动 | react-virtuoso（已禁用）| v1.2.0 | ⚠️ |
| 主题切换 | 自动/亮/暗 | v1.2.0 | ✅ |
| 全局快捷键 | 10+ 快捷键 | v1.2.1 | ✅ |
| **安全加固** | 45+ 保护规则 | v1.3.0 | ✅ |
| **Tab 右键菜单** | 关闭当前/其他/所有 | v1.3.0 | ✅ |
| **Markdown 右键菜单** | 导出/复制 | v1.3.0 | ✅ |
| **剪贴板重构** | 单一数据源 | v1.3.0 | ✅ |
| **多文件选择** | Cmd+点击、Shift+点击 | v1.3.0 | ✅ |
| **跨应用剪贴板** | Finder ↔ MD Viewer | v1.3.0 | ✅ |
| **可调侧边栏** | 拖拽调整宽度 | v1.3.0 | ✅ |

---

## 📊 **版本规划**

| 版本 | 核心功能 | 状态 |
|------|----------|------|
| v1.0 | 纯预览器 | ✅ 完成 |
| v1.1 | Mermaid + 文件监听 | ✅ 完成 |
| v1.1.1 | Bug修复 | ✅ 完成 |
| v1.1.2 | KaTeX/Mermaid 修复 | ✅ 完成 |
| v1.2.0 | 安全 + 右键 + 剪贴板 + 虚拟滚动 + 主题 | ✅ 已发布 |
| v1.2.1 | 快捷键 + E2E + 测试扩展 | ✅ 完成 |
| **v1.3.0** | **Tab菜单 + Markdown菜单 + 多选 + 跨应用剪贴板** | ✅ **开发完成** |
| v1.4 | 拖拽操作 + 性能优化 | 未开始 |
| v2.0 | 插件系统 | 未开始 |

---

## 📅 **变更历史**

| 日期 | 时间 | 变更内容 |
|------|------|----------|
| 2026-01-02 | 14:00 | 项目初始化 |
| 2026-01-02 | 23:00 | v1.0.0 发布 |
| 2026-01-03 | 07:00 | v1.1.0 发布 |
| 2026-01-03 | 17:00 | v1.1.1 发布 |
| 2026-01-03 | 18:30 | v1.1.2 发布 |
| 2026-01-03 | 21:36 | v1.2.0 发布 ✅ |
| 2026-01-03 | 22:00 | v1.2.1 优化完成 ✅ |
| 2026-01-04 | 10:00 | v1.3 规划完成，4 位专家审批通过 📋 |
| 2026-01-04 | 11:00 | v1.3 阶段 0-3 完成 |
| **2026-01-04** | **12:30** | **v1.3 全部 8 个阶段完成 + Bug 修复 + 侧边栏可调** ✅ |
| **2026-01-04** | **13:10** | **v1.3.1 Markdown 样式优化（MPE GitHub 主题移植）** ✅ |

---

**更新频率**：实时更新
**维护者**：wj2929
**当前状态**：✅ **v1.3.1 样式优化完成（MPE GitHub 主题）**
